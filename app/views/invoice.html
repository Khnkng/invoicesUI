<div>
    <form [formGroup]="invoiceForm">
        <div class="new-invoice row" foundation *ngIf="showInvoice">
            <div class="column small-12 medium-12 large-12 qount-form-backgorund">
                <div class="qount-off-canvas-menu chart-of-accounts">
                    <div class="flyout expanded" [ngClass]="{'expanded':true}">
                        <section class="flyout-placeholder">
                            <div class="flyout-body flyout-shadow-effect">
                                <section class="form-section clearfix">
                                    <div class="row">

                                        <div class="small-12 medium-9 columns" *ngIf="!showPreview">
                                            <div class="row">
                                                <div class="small-12 medium-6 columns">
                                                    <div class="row">
                                                        <div class="small-12 medium-8 columns" style="padding:0" *ngIf="!hasPaid">
                                                            <label>
                                                                Select Customer*
                                                                <select formControlName="customer_id" (change)="onCustomerSelect($event.target.value,customer)">
                                                                    <option *ngFor="let customer of customers" value="{{customer.customer_id}}">{{customer.customer_name}}</option>
                                                                </select>
                                                            </label>
                                                        </div>
                                                        <div class="small-12 medium-8 columns" style="padding:0" *ngIf="hasPaid">
                                                            <label>
                                                                Select Customer*
                                                                <select class="jeSelect" formControlName="customer_id" (change)="onCustomerSelect($event.target.value,customer)" disabled>
                                                                    <option *ngFor="let customer of customers" value="{{customer.customer_id}}">{{customer.customer_name}}</option>
                                                                </select>
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="small-12 medium-6 columns" style="padding:0" *ngIf="!hasPaid">
                                                            <label>
                                                                Send To*
                                                                <select formControlName="send_to" (change)="onCustomerContactSelect($event.target.value)">
                                                                    <option *ngFor="let customerContact of customerContacts" value="{{customerContact.id}}">{{customerContact.first_name +" "+ customerContact.last_name}}</option>
                                                                </select>
                                                            </label>
                                                        </div>
                                                        <div class="small-12 medium-6 columns" style="padding:0" *ngIf="hasPaid">
                                                            <label>
                                                                Send To*
                                                                <select class="jeSelect" formControlName="send_to" (change)="onCustomerContactSelect($event.target.value)" disabled>
                                                                    <option *ngFor="let customerContact of customerContacts" value="{{customerContact.id}}">{{customerContact.first_name +" "+ customerContact.last_name}}</option>
                                                                </select>
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="small-12 medium-5 columns" style="padding: 0px">
                                                            <label>
                                                                Address
                                                                <div style="color:grey">
                                                                    {{selectedCustomer.street_1?selectedCustomer.street_1:""}}
                                                                </div>
                                                                <div style="color:grey" *ngIf="invoiceForm.controls.customer_id.value">
                                                                    {{selectedCustomer.customer_city?selectedCustomer.customer_city:""}},{{selectedCustomer.customer_zipcode?selectedCustomer.customer_zipcode:""}}
                                                                </div >
                                                                <div style="color:grey">
                                                                    {{selectedCustomer.customer_country?selectedCustomer.customer_country:""}}
                                                                </div>
                                                            </label>
                                                        </div>
                                                        <div class="small-12 medium-5 columns">
                                                            <label>
                                                                Contact
                                                                <div style="color:grey">
                                                                    {{selectedContact?selectedContact.mobile:""}}
                                                                </div>
                                                                <div style="color:grey">
                                                                    {{selectedContact?selectedContact.email:""}}
                                                                </div>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="small-12 medium-5 columns">
                                                    <div class="row">
                                                        <div class="small-12 medium-6 columns">
                                                            <div class="row" *ngIf="!hasPaid">
                                                                <label>
                                                                    Invoice Number*
                                                                    <input type="text" formControlName="number"/>
                                                                </label>
                                                            </div>
                                                            <div class="row" *ngIf="hasPaid">
                                                                <label>
                                                                    Invoice Number*
                                                                    <input type="text" formControlName="number" readonly />
                                                                </label>
                                                            </div>
                                                            <div class="row" *ngIf="!hasPaid">
                                                                <label>
                                                                    Invoice Date*
                                                                    <input type="text" formControlName="invoice_date" invoice-custom-datepicker [format]="dateFormat" [mindate]="'past'" (valueChanged)="setInvoiceDate($event)" placeholder="Invoice Date*"/>
                                                                </label>
                                                            </div>
                                                            <div class="row" *ngIf="hasPaid">
                                                                <label>
                                                                    Invoice Date*
                                                                    <input type="text" formControlName="invoice_date" readonly/>
                                                                </label>
                                                            </div>
                                                            <div class="row" *ngIf="!hasPaid">
                                                                <div class="small-12 medium-12 columns" style="padding: 0px">
                                                                    <label>
                                                                        Select Currency*
                                                                        <select formControlName="currency" (change)="onCurrencySelect($event.target.value)">
                                                                            <option value="USD">USD</option>
                                                                            <option value="INR">INR</option>
                                                                            <option value="IDR">IDR</option>
                                                                        </select>
                                                                    </label>
                                                                </div>
                                                            </div>
                                                            <div class="row" *ngIf="hasPaid">
                                                                <div class="small-12 medium-12 columns" style="padding: 0px">
                                                                    <label>
                                                                        Select Currency*
                                                                        <select class="jeSelect" formControlName="currency" (change)="onCurrencySelect($event.target.value)" disabled>
                                                                            <option value="USD">USD</option>
                                                                            <option value="INR">INR</option>
                                                                            <option value="IDR">IDR</option>
                                                                        </select>
                                                                    </label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="small-12 medium-6 columns">
                                                            <div class="row" *ngIf="!hasPaid">
                                                                <div class="small-12 medium-12 columns" style="padding: 0px">
                                                                    <label>
                                                                        Terms*
                                                                        <select formControlName="term" placeholder="Terms" (change)="selectTerm($event.target.value)">
                                                                            <option [value]="'net30'">Net 30</option>
                                                                            <option [value]="'net45'">Net 45</option>
                                                                            <option [value]="'net60'">Net 60</option>
                                                                            <option [value]="'net90'">Net 90</option>
                                                                            <option [value]="'custom'">Custom</option>
                                                                        </select>
                                                                    </label>
                                                                </div>
                                                            </div>
                                                            <div class="row" *ngIf="hasPaid">
                                                                <div class="small-12 medium-12 columns" style="padding: 0px">
                                                                    <label>
                                                                        Terms*
                                                                        <select class="jeSelect" formControlName="term" placeholder="Terms" disabled>
                                                                            <option [value]="'net30'">Net 30</option>
                                                                            <option [value]="'net45'">Net 45</option>
                                                                            <option [value]="'net60'">Net 60</option>
                                                                            <option [value]="'net90'">Net 90</option>
                                                                            <option [value]="'custom'">Custom</option>
                                                                        </select>
                                                                    </label>
                                                                </div>
                                                            </div>
                                                            <div class="row" *ngIf="!hasPaid">
                                                                <label>
                                                                    Due Date*
                                                                    <input type="text" formControlName="due_date" invoice-custom-datepicker datepicker1 [format]="dateFormat" [mindate]="'past'" (valueChanged)="setPaymentDate($event)" placeholder="Payment Date*">
                                                                </label>
                                                            </div>
                                                            <div class="row" *ngIf="hasPaid">
                                                                <label>
                                                                    Due Date*
                                                                    <input type="text" formControlName="due_date" readonly>
                                                                </label>
                                                            </div>
                                                            <div class="row" *ngIf="!hasPaid&&!isPastDue">
                                                                <div class="small-12 medium-12 columns" style="padding: 0px">
                                                                    <label>
                                                                        Late Fee
                                                                        <select formControlName="late_fee_id">
                                                                            <option *ngFor="let lateFee of lateFees" value="{{lateFee.id}}">{{lateFee.name}}</option>
                                                                        </select>
                                                                    </label>
                                                                </div>
                                                            </div>
                                                            <div class="row" *ngIf="hasPaid||isPastDue">
                                                                <div class="small-12 medium-12 columns" style="padding: 0px">
                                                                    <label>
                                                                        Late Fee
                                                                        <select class="jeSelect" formControlName="late_fee_id" disabled>
                                                                            <option *ngFor="let lateFee of lateFees" value="{{lateFee.id}}">{{lateFee.name}}</option>
                                                                        </select>
                                                                    </label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row" style="margin-top: 1rem;">
                                                <!--<table border="1" formArrayName="taskLines">
                                                    <thead>
                                                    <tr>
                                                        <th width="13%;" *ngIf="!showItemName">{{tasks}}</th>
                                                        <th width="13%;" *ngIf="!showDescription">Description</th>
                                                        <th width="7%;" *ngIf="!showUnitCost">{{unitCost}}</th>
                                                        <th width="7%;" *ngIf="!showUOM">{{UOM}}</th>
                                                        <th width="13%;">Tax</th>
                                                        <th width="7%;">Tax Amount</th>
                                                        <th width="7%;">Line Total</th>
                                                        <th width="5%" *ngIf="!hasPaid"></th>
                                                    </tr>
                                                    </thead>

                                                    <tbody  *ngFor="let invoiceLine of invoiceForm.controls.taskLines.controls;let iindex=index;" [hidden]="invoiceLine.controls.destroy.value" (click)="editItem(iindex, invoiceLine,'task')">
                                                    <tr [formGroupName]="iindex">
                                                        <td class="truncate" *ngIf="!showItemName&&!invoiceLine.editable">{{getItemCodeName(invoiceLine.controls.item_id.value)}}</td>
                                                        <td *ngIf="!showItemName&&invoiceLine.editable" class="combo-box-field">
                                                            <select [formControl]="invoiceLine.controls.item_id" (change)="itemChange($event.target.value,iindex,'task')">
                                                                <option *ngFor="let item of taskItemCodes" [value]="item.id">{{item.name}}</option>
                                                            </select>
                                                        </td>
                                                        <td class="truncate" *ngIf="!showDescription&&!invoiceLine.editable">{{invoiceLine.controls.description.value}}</td>

                                                        <td *ngIf="!showDescription&&invoiceLine.editable">
                                                            <input type="text" [formControl]="invoiceLine.controls.description"/>
                                                        </td>

                                                        <td class="truncate" *ngIf="!showUnitCost&&!invoiceLine.editable">{{invoiceLine.controls.price.value?formatAmount(invoiceLine.controls.price.value):null}}</td>

                                                        <td *ngIf="!showUnitCost&&invoiceLine.editable">
                                                            <input type="text" [formControl]="invoiceLine.controls.price" numeral [locale]="localeFormat" [format]="'$0,0.00'" (change)="calculateTotals()"/>
                                                        </td>

                                                        <td class="truncate" *ngIf="!showUOM&&!invoiceLine.editable">{{invoiceLine.controls.quantity.value?formatQuantity(invoiceLine.controls.quantity.value):null}}</td>

                                                        <td *ngIf="!showUOM&&invoiceLine.editable">
                                                            <input type="text" [locale]="localeFormat" [isNumber]="true" [format]="'0,0.0000'" numeral [formControl]="invoiceLine.controls.quantity" (change)="calculateTotals()" />
                                                        </td>
                                                        <td class="truncate" *ngIf="!invoiceLine.editable">{{getTaxName(invoiceLine.controls.tax_id.value)}}</td>
                                                        <td class="combo-box-field" *ngIf="invoiceLine.editable">
                                                            <select [formControl]="invoiceLine.controls.tax_id" (change)="calculateTotals()">
                                                                <option *ngFor="let taxItem of taxesList" [value]="taxItem.id">{{taxItem.name}} - {{taxItem.taxRate}}</option>
                                                            </select>
                                                        </td>
                                                        <td style="text-align: right;background-color:#E3F7F6;">
                                                            {{formattedTaxTotal(invoiceLine.controls.tax_id.value,invoiceLine.controls.price.value,invoiceLine.controls.quantity.value)}}
                                                        </td>
                                                        <td style="text-align: right;background-color: #E3F7F6">
                                                            {{formattedLineTotal(invoiceLine.controls.price.value,invoiceLine.controls.quantity.value)}}
                                                        </td>
                                                        <td *ngIf="!hasPaid">
                                                            <span (click)="editInvoiceLine($event, iindex,'taskLines')">
                                                        <i class="icon ion-edit"></i>
                                                    </span>
                                                            <span (click)="deleteLineItem($event,iindex,'taskLines')">
                                                        <i class="icon ion-ios-trash-outline"></i>
                                                    </span>
                                                        </td>

                                                    </tr>
                                                    </tbody>
                                                </table>-->


                                                <table border="1" style="margin-top: 2rem;" formArrayName="invoiceLines">
                                                    <thead>
                                                    <tr>
                                                        <th width="13%;">{{tasks}}</th>
                                                        <th width="13%;">Description</th>
                                                        <th width="7%;">{{unitCost}}</th>
                                                        <th width="7%;">{{UOM}}</th>
                                                        <th width="13%;">Tax</th>
                                                        <th width="7%">Tax Amount</th>
                                                        <th width="7%;">Line Total</th>
                                                        <th width="5%" *ngIf="!hasPaid"></th>
                                                    </tr>
                                                    </thead>

                                                    <tbody  *ngFor="let invoiceLine of invoiceForm.controls.invoiceLines.controls;let iindex=index;" [hidden]="invoiceLine.controls.destroy.value" (click)="editItem(iindex, invoiceLine,'item')">
                                                    <tr [formGroupName]="iindex">
                                                        <td class="truncate" *ngIf="!invoiceLine.editable">{{getItemCodeName(invoiceLine.controls.item_id.value)}}</td>
                                                        <td *ngIf="invoiceLine.editable" class="combo-box-field">
                                                            <select [formControl]="invoiceLine.controls.item_id" (change)="itemChange($event.target.value,iindex,'item')">
                                                                <option *ngFor="let item of itemItemCodes" [value]="item.id">{{item.name}}</option>
                                                            </select>
                                                        </td>
                                                        <td class="truncate" *ngIf="!invoiceLine.editable">{{invoiceLine.controls.description.value}}</td>

                                                        <td *ngIf="invoiceLine.editable">
                                                            <input type="text" [formControl]="invoiceLine.controls.description"/>
                                                        </td>

                                                        <td class="truncate" *ngIf="!invoiceLine.editable">{{invoiceLine.controls.price.value?formatAmount(invoiceLine.controls.price.value):null}}</td>

                                                        <td *ngIf="invoiceLine.editable">
                                                            <input type="text" (change)="calculateTotals()" [formControl]="invoiceLine.controls.price" numeral [locale]="localeFormat" [format]="'$0,0.00'"/>
                                                        </td>

                                                        <td class="truncate" *ngIf="!invoiceLine.editable">{{invoiceLine.controls.quantity.value?formatQuantity(invoiceLine.controls.quantity.value):null}}</td>

                                                        <td *ngIf="invoiceLine.editable">
                                                            <input type="text" [locale]="localeFormat" [isNumber]="true" [format]="'0,0.0000'" numeral [formControl]="invoiceLine.controls.quantity" (change)="calculateTotals()" />
                                                        </td>
                                                        <td class="truncate" *ngIf="!invoiceLine.editable">{{getTaxName(invoiceLine.controls.tax_id.value)}}</td>
                                                        <td class="combo-box-field" *ngIf="invoiceLine.editable">
                                                            <select [formControl]="invoiceLine.controls.tax_id" (change)="calculateTotals()">
                                                                <option *ngFor="let taxItem of taxesList" [value]="taxItem.id">{{taxItem.name}} - {{taxItem.taxRate}}</option>
                                                            </select>
                                                        </td>
                                                        <td style="text-align: right;background-color: #E3F7F6">
                                                            {{formattedTaxTotal(invoiceLine.controls.tax_id.value,invoiceLine.controls.price.value,invoiceLine.controls.quantity.value)}}
                                                        </td>
                                                        <td style="text-align: right;background-color: #E3F7F6">
                                                            {{formattedLineTotal(invoiceLine.controls.price.value,invoiceLine.controls.quantity.value)}}
                                                        </td>
                                                        <td *ngIf="!hasPaid">
                                                            <span (click)="editInvoiceLine($event, iindex,'invoiceLines')">
                                                        <i class="icon ion-edit"></i></span>
                                                            <span (click)="deleteLineItem($event,iindex,'invoiceLines')">
                                                        <i class="icon ion-ios-trash-outline"></i>
                                                            </span>
                                                        </td>
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            <div class="row" style="margin-bottom: 2rem;margin-top: 2rem;">
                                                <div class="small-12 medium-7 columns"></div>
                                                <div class="small-12 medium-5 columns" style="padding: 0;">
                                                    <table>
                                                        <tbody>
                                                        <tr>
                                                            <td style="background: #E5E5E5;">
                                                                Subtotal
                                                            </td>
                                                            <td style="text-align:right;">{{formatAmount(subTotal)}}</td>
                                                        </tr>
                                                        <tr>
                                                            <td style="background: #E5E5E5;">
                                                                Tax
                                                            </td>
                                                            <td style="text-align:right;">{{formatAmount(taxTotal)}}</td>
                                                        </tr>
                                                        <!--<tr>
                                                            <td style="background: #E5E5E5;">
                                                                Discount
                                                            </td>
                                                            <td><input type="text" formControlName="discount" numeral [format]="'$0,0.00'" [locale]="localeFormat" placeholder="Discount"></td>
                                                        </tr>-->
                                                        <tr *ngIf="!newInvoice&&validateLateFeeAmount()">
                                                            <td style="background: #E5E5E5;">
                                                                Late Fee
                                                            </td>
                                                            <td style="text-align:right;">{{formatAmount(lateFeeAmount)}}</td></tr>
                                                        <tr *ngIf="!newInvoice">
                                                            <td style="background: #E5E5E5;">
                                                                Amount Paid
                                                            </td>
                                                            <td style="text-align:right;">{{formatAmount(amount_paid)}}</td></tr>
                                                        <tr *ngIf="!newInvoice">
                                                            <td style="background: #E5E5E5;">
                                                                Amount Due
                                                            </td>
                                                            <td style="text-align:right;">{{formatAmount(calculateAmount(amount_paid))}}</td></tr>
                                                        <tr style="background:#E3F7F6" *ngIf="newInvoice">
                                                            <td>
                                                                Total
                                                            </td>
                                                            <td style="text-align:right;" *ngIf="!hasPaid">
                                                                {{formatAmount(calculateAmount(amount_paid))}}
                                                            </td>
                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="small-12 medium-7 large-7 columns" *ngIf="showPreview" style="margin-bottom:2rem">
                                            <invoicePaymentPreview [invoices]="invoiceProcessedData"></invoicePaymentPreview>
                                        </div>

                                        <div class="small-12 medium-3 columns">
                                            <div class="row" >
                                                <div class="small-12 medium-12 columns" style="padding: 0;color: #4b4b9e;font-size: 14px;font-weight: 600;height: 25px;" *ngIf="newInvoice||(invoice&&invoice.state=='draft')">
                                                    <button (click)="submit($event,false,'draft')" class="button small" [disabled]="hasPaid||!invoiceForm.valid||!validateTaskLines()" style="padding: 0;height: 20px;background-color: white !important;color: #4b4b9e;font-size: 14px;height: 25px;">Save as Draft</button>
                                                </div>
                                                <div class="small-12 medium-12 columns" style="padding: 0;color: #4b4b9e;font-size: 14px;font-weight: 600;height: 25px;" *ngIf="!newInvoice&&(invoice&&(invoice.state!='draft'&&invoice.state!='paid'))">
                                                    <button (click)="submit($event,false,'save')" class="button small" [disabled]="hasPaid||!invoiceForm.valid||!validateTaskLines()" style="padding: 0;height: 20px;background-color: white !important;color: #4b4b9e;font-size: 14px;height: 25px;">Save</button>
                                                </div>
                                                <div class="small-12 medium-12 columns" style="padding: 0;color: #4b4b9e;font-size: 14px;font-weight: 600;height: 25px;" *ngIf="displayCommission">
                                                    <button (click)="applyCommission()" class="button small" [disabled]="hasPaid||!invoiceForm.valid||!validateTaskLines()" style="padding: 0;height: 20px;background-color: white !important;color: #4b4b9e;font-size: 14px;height: 25px;">Sales Commission</button>
                                                </div>
                                                <div class="small-12 medium-12 columns" style="padding: 0;color: #4b4b9e;font-size: 14px;font-weight: 600;height: 40px;" *ngIf="newInvoice">
                                                    <button [disabled]="!invoiceForm.valid||!validateTaskLines()" (click)="submit($event,false,'preview')" class="button small" style="padding: 0;height: 20px;background-color: white !important;color: #4b4b9e;font-size: 14px;">{{preViewText}}</button>
                                                </div>
                                                <div class="small-12 medium-12 columns" style="padding: 0;color: #4b4b9e;font-size: 14px;font-weight: 600;height: 25px;" *ngIf="!newInvoice">
                                                    <button [disabled]="!invoiceForm.valid||!validateTaskLines()" (click)="submit($event,false,'preview')" class="button small" style="padding: 0;height: 20px;background-color: white !important;color: #4b4b9e;font-size: 14px;">{{preViewText}}</button>
                                                </div>
                                                <div class="small-12 medium-12 columns" style="padding: 0;color: #4b4b9e;font-size: 14px;font-weight: 600;height: 40px;" *ngIf="!newInvoice">
                                                    <button (click)="showHistory()" class="button small" style="padding: 0;background-color: white !important;color: #4b4b9e;font-size: 14px;">View History</button>
                                                </div>
                                                <!--<div *ngIf="showPreview" class="small-12 medium-12 columns" style="padding: 0;color: #4b4b9e;font-size: 14px;font-weight: 600;">
                                                    <button (click)="submit($event,false,'preview')" class="button small" style="padding: 0;height: 20px;background-color: white !important;color: #4b4b9e;font-size: 14px;">Close Preview</button>
                                                </div>-->
                                            </div>
                                            <div class="row">
                                                <span style="font-size: 12px;">Send invoice to {{selectedCustomer?selectedCustomer.customer_name:""}}</span>
                                            </div>
                                            <div class="row">
                                                <button style="padding: 18px 40px;width: 180px" class="button small" (click)="submit($event,true,'email')" [disabled]="!invoiceForm.valid||!validateTaskLines()">Email Invoice</button>
                                            </div>
                                            <div class="row">
                                                <button style="padding: 18px 40px;width: 180px" class="button small hollow download"(click)="submit($event,false,'download')" [disabled]="!invoiceForm.valid||!validateTaskLines()">Download PDF</button>
                                            </div>

                                            <div class="row" *ngIf="!showPreview" style="margin-top: 27px">
                                                <div class="small-12 medium-12 columns" style="padding: 0px">
                                                    <label>
                                                        Attachments
                                                    </label>
                                                </div>
                                            </div>
                                            <div *ngIf="!showPreview">
                                                <div class="row" *ngFor="let attachment of attachments" style="margin-bottom: 15px">
                                                    <div class="small-12 medium-12 columns" style="padding: 0px">
                                                        <div style="width: 273px;height: 60px;border: 1px solid #878787;background: #e5e5e5"><span style="float: right;cursor: pointer;padding:11px;color: grey" (click)="removeAttachment(attachment)"><i class="icon ion-ios-close-empty" style="font-size: 1.8rem"></i></span>
                                                            <div style="padding:11px;margin-top: 7px"><a href="{{attachment.temporaryURL}}" style="font-size: 14px;color: #4b4b9e;width: 220px;text-overflow: ellipsis;display: block;overflow: hidden;white-space: nowrap;" target="_blank">{{attachment.name}}</a></div></div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row" *ngIf="!showPreview">
                                                <div class="small-12 medium-12 columns" style="padding: 0px">
                                                    <div class="file-upload-modal">
                                                        <section class="upload-area" style="width: 273px;line-height: 60px;margin: 0px" ng2FileDrop [uploader]="uploader" (fileOver)="fileOverBase($event)" >
                                                            <div class="row upload-choose-btn" style="background: #e5e5e5;padding: 0px;border: 1.5px dashed  #848484;" [ngClass]="{'popup-file-over': hasBaseDropZoneOver}">
                                                                <div class="column text-center">
                                                                    <label for="nativeFileUpload" class="button" style="background: transparent;text-decoration: underline;padding: 0px;margin-top: 1rem;color: #4b4b9e !important;font-size: 14px">Upload</label>
                                                                    <span style="color: #4b4b9e;font-size: 14px">or Drag and Drop</span>
                                                                    <input type="file" id="nativeFileUpload" (change)="startUpload($event)" value="null" class="show-for-sr" ng2FileSelect [uploader]="uploader" />
                                                                </div>
                                                            </div>
                                                            <div class="row files-to-upload-section">
                                                                <ul *ngIf="uploader.queue.length>0">
                                                                    <li *ngFor="let item of uploader.queue">
                                                                        <div class="row">
                                                                            <div class="column small-10 medium-10" [ngClass]="{'item-uploaded':item.isSuccess}">
                                                        <span *ngIf="!(item.isReady || item.isUploading || item.isSuccess)">
                                                          <i class="ion-ios-cloud-upload-outline" (click)="item.upload()"></i>
                                                        </span>
                                                                                {{ item?.file?.name }} &nbsp;({{ item?.file?.size/1024/1024 | number:'.2' }} MB)
                                                                            </div>
                                                                            <div class="column small-2 text-right">
                                                                                <i *ngIf="(item.isUploading)" class="ion-ios-close-outline" (click)="item.cancel()"></i>
                                                                                <i class="ion-ios-minus-outline" (click)="removeUploadItem(item)"></i>
                                                                            </div>
                                                                        </div>
                                                                        <div *ngIf="item.isUploading">
                                                                            <div class="progress">
                                                                                <div class="progress-meter" [ngStyle]="{ 'width': item.progress + '%' }"></div>
                                                                            </div>
                                                                        </div>
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        </section>
                                                    </div>
                                                </div>
                                            </div>

                                            <!--<div class="row" style="margin-top: 1.2rem" *ngIf="!showPreview&&!hasPaid">
                                                <div class="small-12 medium-12 columns" style="padding: 0px">
                                                    <label>
                                                        Notes
                                                        <textarea formControlName="notes" style="height: 130px;width: 80%;"></textarea>
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="row" style="margin-top: 1.2rem" *ngIf="!showPreview&&hasPaid">
                                                <div class="small-12 medium-12 columns" style="padding: 0px">
                                                    <label>
                                                        Notes
                                                        <textarea readonly formControlName="notes" style="height: 130px;width: 80%;"></textarea>
                                                    </label>
                                                </div>
                                            </div>-->

                                            <!--<div class="row" style="margin-top: 0.5rem" *ngIf="!showPreview&&!hasPaid">
                                                <div class="small-12 medium-12 columns" style="padding: 0px">
                                                    <label>
                                                        Payment Options
                                                        <textarea formControlName="payment_options" style="height: 130px;width: 80%;"></textarea>
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="row" style="margin-top: 0.5rem" *ngIf="!showPreview&&hasPaid">
                                                <div class="small-12 medium-12 columns" style="padding: 0px">
                                                    <label>
                                                        Payment Options
                                                        <textarea readonly formControlName="payment_options" style="height: 130px;width: 80%;"></textarea>
                                                    </label>
                                                </div>
                                            </div>-->
                                            <!--<div class="row" style="margin-top: 0.5rem" *ngIf="!showPreview">
                                                <div class="small-12 medium-12 columns" style="padding: 0px" *ngIf="invoiceID">
                                                    <span class="label warning" style="width: 50px;text-align: center;font-size: 13pt;background: #00B1A9;">{{coreValue}}</span>
                                                </div>
                                            </div>-->
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <div class="report-wrapper journal-flyout">
        <div class="sidenav customization-panel" [ngClass]="dimensionFlyoutCSS" foundation>
            <!--<button class="close-button " data-close aria-label="Close modal" type="button">
                <span aria-hidden="true">
                  <i class="ion-ios-close-empty" (click)="hideFlyout()"></i>
                </span>
            </button>-->
            <div class="row collapse dimension-flyout">
                    <div class="small-12 medium-12 small-centered column">
                        <h5>Invoice Details</h5>
                    </div>
            </div>
            <form *ngIf="itemActive" novalidate [formGroup]="editItemForm">
                <div class="row collapse dimension-flyout">
                    <div class="small-12 medium-6 columns">
                        <div class="row">
                            <div class="column small-12 medium-6">
                                <label>
                                    Item Code
                                    <select formControlName="item_id" (change)="displayItemCodeCOA($event.target.value)">
                                        <option *ngFor="let item of itemCodes" [value]="item.id">{{item.name}}</option>
                                    </select>
                                </label>
                            </div>
                            <div class="column small-12 medium-6">
                                <label>
                                    Description
                                    <input type="text" formControlName="description" placeholder="Description" />
                                </label>
                            </div>

                            <div class="column small-12 medium-6">
                                <label>
                                    Quantity
                                    <input [locale]="localeFormat" [isNumber]="true" [format]="'0,0.0000'" numeral type="text" formControlName="quantity" placeholder="Quantity">
                                </label>
                            </div>

                            <div class="column  small-12 medium-6">
                                <label>
                                    Price
                                    <input type="text" formControlName="price" numeral [format]="'$0,0.00'" [locale]="localeFormat" placeholder="Price">
                                </label>
                            </div>
                            <div class="column small-12 medium-6">
                                <label>
                                    Tax
                                    <select formControlName="tax_id" (change)="calculateTotals()">
                                        <option *ngFor="let taxItem of taxesList" [value]="taxItem.id">{{taxItem.name}} - {{taxItem.taxRate}}</option>
                                    </select>
                                </label>
                            </div>
                            <div class="column small-12 medium-6">
                                <label>
                                    Tax Amount
                                    <input type="text" value="{{formattedTaxTotal(editItemForm.controls.tax_id.value,editItemForm.controls.price.value,editItemForm.controls.quantity.value)}}" readonly/>
                                </label>
                            </div>
                            <div class="column small-12 medium-6">
                                <label>
                                    Line Amount
                                    <input type="text" value="{{formattedLineTotal(editItemForm.controls.price.value,editItemForm.controls.quantity.value)}}" readonly/>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="small-12 medium-6 columns">
                        <label>Dimensions
                            <div class="row dimension-grids" (click)="doNothing($event)">
                                <div class="small-12 medium-4 columns dimension-grid" *ngFor="let dimension of dimensions">
                                    <div class="dimension-header">
                                        <div>
                                            <span class="float-left">{{dimension.name}}</span>
                                        <span class="float-right">
                                                    <i class="icon ion-checkmark-circled" [ngClass]="{'selected': isDimensionSelected(dimension.name)}"
                                                       (click)="selectDimension($event, dimension.name)"></i>
                                                </span>
                                        </div>
                                        <div class="bottom" [ngClass]="{'selected': isDimensionSelected(dimension.name)}"></div>
                                    </div>
                                    <div class="dimension-values" [ngClass]="{'selected': isDimensionSelected(dimension.name)}">
                                        <div class="dimension-value" *ngFor="let value of dimension.values; let index = index;">
                                            <label (click)="selectValue($event, dimension, value)">
                                                <input type="checkbox" [checked]="isValueSelected(dimension, value)"/>{{value}}
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </label>
                    </div>
                    <div class="small-12 medium-12 columns">
                        <input type="button" class="button small float-right" value="Update" (click)="saveItem()"/>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="reveal small bill-modal-container" style="width: 40%;padding: 0;border: 1px;margin-top: 6rem;" id="invoice-email-conformation" data-reveal foundation  data-close-on-click="false">
    <div class="row">
        <div class="small-12 medium-12 columns" style="padding: 0; background: #00B1A9;height: 3rem;">
            <label style="margin-left: 1rem;text-align: left;margin-top: 0.5rem;color: white;font-size: 13pt;">Send Invoice to the {{selectedCustomer?selectedCustomer.customer_name:""}} ({{selectedContact?selectedContact.email:""}})?
            </label>
        </div>
    </div>
    <div class="row" style="padding: 1rem 1rem 0 1rem;margin-top: 1rem;">
        <div class="small-12 medium-12 columns">
            <input type="text" [(ngModel)]="additionalMails" placeholder="Please enter comma separated mails">
        </div>
    </div>
    <div class="row" style="padding: 1rem 1rem 0 1rem;">
        <div class="small-12 medium-12 columns">
            <textarea [(ngModel)]="notes" rows="3" placeholder="Notes"></textarea>
        </div>
    </div>
    <div class="row" style="padding: 0rem 1rem;" >
        <div class="small-12 medium-9 columns">
            <label style="text-align: left; font-size: 13pt;color: #878787">Set email alerts when invoice is due ?
                <select [(ngModel)]="remainder_name">
                  <option value="">--None--</option>
                    <option value="weekly start two weeks before due">Weekly, start two weeks before due</option>
                    <option value="on due date,then weekly afterward">On date due, then weekly afterward</option>
                    <option value="weekly until paid">Weekly until paid</option>
                </select>
            </label>
        </div>
    </div>
    <div class="text-right" style="padding-right:1rem">
        <button class="button small" style="background: #00B1A9;" (click)="sendInvoiceMails()">Send Invoice</button>
        <button class="button small" style="background-color: white !important;color: #878787;" (click)="closeEmailDailog()">Cancel</button>
    </div>
</div>


<div class="small-12 medium-12 small-centered column" *ngIf="showInvoiceHistory">
    <div style="margin:20px 0 30px 0">
        <div *ngIf="historyList.length>0">
            <div class="row rdCircles" *ngFor="let history of historyList; let last=last;">
                <div class="column medium-1" style="padding-left: 55px">
                    <div class="dec1" [style.border]="history.color"></div>
                    <div class="dec2"></div>
                    <div class="dec1" *ngIf="last? true:false;" [style.border]="history.color"></div>
                </div>
                <div class="column medium-11" style="padding-left:0px">
                    <div class="row rdCredits">
                        <div class="column medium-12">
                            <div class="row creditInfo">
                                <div class="column medium-6 text-left">{{history.action}}</div>
                                <div class="column medium-6 text-right" style="font-size: 0.85em">{{history.action_at}}</div>
                            </div>
                        </div>
                        <div class="column medium-12 rdDescription">
                            <div class="row credit-desc" *ngIf="history.action!='Partially paid'||history.action!='Paid'">
                                <div class="column medium-10">{{history.email_to}}</div>
                            </div>
                            <div class="row credit-desc" *ngIf="history.action=='Partially paid'||history.action=='Paid'">
                                <div class="column medium-10">Paid Amount: {{formatAmount(history.amount_paid)}}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div *ngIf="historyList.length==0" class="text-center">History is not available.</div>
    </div>
</div>
<!--
<div class="report-wrapper journal-flyout">
    <div class="sidenav customization-panel" [ngClass]="historyFlyoutCSS" foundation>
        <div class="row collapse dimension-flyout">

        </div>
    </div>
</div>-->

<div class="small-12 medium-12 small-centered column" *ngIf="showCommission">
    <div class="row">
        <div class="small-12 medium-12 column" style="margin-top: 1.6rem;text-align: right">
      <span class="pointer" (click)="addCommissionLine()">
                          <i class=" icon ion-ios-plus-outline"></i>
                          <span>Commission</span>
                        </span>
        </div>
    </div>
    <div class="row" *ngIf="showAddCommission">
        <div class="column small-12 medium-2">
            <label>
                Vendor
                <select  placeholder="Vendor *" [(ngModel)]="commissionObj.vendor_id">
                    <option selected="selected" *ngFor="let vendor of vendors" value="{{vendor.id}}">{{vendor.name}}</option>
                </select>
            </label>
        </div>
        <div class="column small-12 medium-2">
            <label>
                Pay Event
                <select  placeholder="Type *" [(ngModel)]="commissionObj.event_at">
                    <option value="create">Create</option>
                    <option value="paid">Paid</option>
                    <option value="custom">Custom</option>
                </select>
            </label>
        </div>
        <div class="column small-12 medium-1" *ngIf="commissionObj.event_at=='custom'">
            <label>
                Event Date
                <input type="text" invoice-custom-datepicker [(ngModel)]="commissionObj.event_date" [format]="dateFormat" [mindate]="'past'" (valueChanged)="setEventDate($event)" placeholder="Event Date"/>
            </label>
        </div>
        <div class="column small-12 medium-2">
            <label>
                Item
                <select [(ngModel)]="commissionObj.item_id">
                    <option *ngFor="let item of itemItemCodes" [value]="item.id">{{item.name}}</option>
                </select>
            </label>
        </div>
        <div class="column small-12 medium-2">
            <label>
                Commission Type
                <select [(ngModel)]="commissionObj.amount_type">
                    <option value="flat_fee">Flat Fee</option>
                    <option value="percentage">Percentage</option>
                </select>
            </label>
        </div>
        <div class="column small-12 medium-1">
            <label>
                Value
                <input type="number" [(ngModel)]="commissionObj.amount">
            </label>
        </div>
        <div class="small-12 medium-2 column">
            <button style="margin-top: 1.5rem;" class="button small" [disabled]="validateCommission()" (click)="createCommission()">Create</button>
        </div>
    </div>
    <div class="row">
        <table border="1">
            <thead>
            <tr>
                <th>Vendor</th>
                <th>Pay Event</th>
                <th >Item</th>
                <th >Commission Type</th>
                <th >Value</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let commission of commissions;let i=index;">
                <td *ngIf="!commission.delete">{{getVendorName(commission.vendor_id)}}
                <td *ngIf="!commission.delete">{{getEventAtName(commission.event_at)}}
                <td *ngIf="!commission.delete">{{getItemCodeName(commission.item_id)}}
                <td *ngIf="!commission.delete">{{getEventTypeName(commission.amount_type)}}</td>
                <td *ngIf="!commission.delete&&commission.amount_type=='percentage'">{{commission.amount}}%</td>
                <td *ngIf="!commission.delete&&commission.amount_type=='flat_fee'">{{formatAmount(commission.amount)}}</td>
                <td *ngIf="!commission.delete">
          <span (click)="editCommission(commission,i)">
                                <i class="icon ion-edit"></i>
                            </span>
                                    <span (click)="deleteCommission(commission,i)">
                                <i class="icon ion-ios-trash-outline"></i>
                            </span>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    <div>
        <input style="margin-top: 1.5rem;float:right" type="button" class="button small" value="Save" (click)="saveCommission()"/>
    </div>
</div>
